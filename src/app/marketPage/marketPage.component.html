

<!-- <!DOCTYPE html>
<html>
<title>Market Page</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-black.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css">
<script src="https://kit.fontawesome.com/cc6a5db783.js" crossorigin="anonymous"></script>

<body> -->

<!-- Navbar -->
<!-- <div class="w3-top">
  <div class="w3-bar w3-black w3-card w3-right">
    <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" 
    title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="#" class="w3-bar-item w3-button w3-padding-large">HOME</a>
    <button class="w3-bar-item w3-button w3-padding-large w3-hide-small" (click)=toBlockChainPage() >Blockchain
    </button>
    <a href="#" class="w3-bar-item w3-button w3-padding-large w3-hide-small">Profile</a>
    <div class="w3-dropdown-hover w3-hide-small">
      <button class="w3-padding-large w3-button" title="More">MORE <i class="fa fa-caret-down"></i></button>     
      <div class="w3-dropdown-content w3-bar-block w3-card-4">
        <a href="#" class="w3-bar-item w3-button">Merchandise</a>
        <a href="#" class="w3-bar-item w3-button">Extras</a>
        <a href="#" class="w3-bar-item w3-button">Media</a>
      </div>
    </div>
    <div>
      <span id="userId" class=" w3-padding-large w3-right"
      style="cursor: pointer"
      (click)=toProfilePage()>
      {{user.UserName}}
      </span>
    </div>
    
  </div>
  
</div> -->
<div>
  <mat-expansion-panel hideToggle
    (afterCollapse)="clear()">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Make a New Order
      </mat-panel-title>
      <mat-panel-description>
        <mat-icon>account_balance_wallet</mat-icon>: {{user.CurrencyBalance}}$
        <mat-icon>battery_charging_full</mat-icon>:    {{user.EnergyBalance}}KWh

      </mat-panel-description>
    </mat-expansion-panel-header>
    <form 
      (ngSubmit)="AddNewOrder()" 
      name="NewOrderForm"
      [formGroup]="NewOrderForm"
      >
      <!-- <p>This is the primary content of the panel.</p> -->
      <div>
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>Amount of Energy</mat-label>
          <input
            type="number" min="0" step="0.01" max="{{maxOrder}}"
            formControlName="amount"
            (keyup)="validate()"
            matInput
            placeholder="Amount in KW/h" required
          />
          <mat-error *ngIf="!NewOrderForm.controls['amount'].valid">
            Please enter a valid amount
          </mat-error>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field class="full-width" appearance="outline">
          <mat-label>Price per KW/h</mat-label>
          <input
            type="number" min="0" step="0.01" 
            formControlName="price"
            (keyup)="validate()"
            matInput
            placeholder="Price per KW/h in $" required
            
          />
        </mat-form-field>
      </div>
      <div>
        <mat-label>Type of Order: </mat-label>
        <mat-radio-group formControlName="type" required>
          <mat-radio-button
            value="Buy"  
            selected
            (change)="validate()"
          >
            Buy
          </mat-radio-button>
          <mat-radio-button
            value="Sell"
            (change)="validate()"
          >
            Sell
          </mat-radio-button>
        </mat-radio-group>  
        <mat-error *ngIf="!NewOrderForm.controls['type'].valid">
          Please select the type of order
        </mat-error>
      </div>
      <button mat-raised-button color="accent">Submit</button>
    </form>
  </mat-expansion-panel>
  <div class="tabs">
    Current Market
    <mat-tab-group mat-align-tabs="center" class="tabs" *ngIf="IsFetched">
    
      <mat-tab class="tabs" label="Buy">  
        <mat-card class="full-width" *ngFor="let order of sellorders">
              
            <div class="row">
              <div class="col">
                <p>
                  Seller: {{order.Seller}}
                </p>
              </div>
              <div class="col">
                <p>
                  Amount: {{order.Amount}} KWh
                </p>
              </div>
              <div class="col">
                <p>
                  Price: {{order.Price}} $/KWh
                </p>
                
              </div>
              <div class="col">
                <button mat-raised-button color="accent" (click)="PressBuySell(order)">Buy</button>
              </div>
            </div>
        </mat-card>
      </mat-tab>
      <mat-tab class="tabs" label="Sell"> 
        <mat-card class="full-width" *ngFor="let order of buyorders">
          <div class="row">
            <div class="col">
              <p>
                Buyer: {{order.Buyer}}
              </p>
            </div>
            <div class="col">
              <p>
                Amount: {{order.Amount}} KWh
              </p>
            </div>
            <div class="col">
              <p>
                Price: {{order.Price}} $/KWh
              </p>
            </div>
            <div class="col">
              <button mat-raised-button color="accent" (click)="PressBuySell(order)">Sell</button>
            </div>
          </div>
        </mat-card>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>

<!-- Header -->
<!-- <header class="w3-container w3-theme w3-padding" id="myHeader">
   
  <div class="w3-center">
  <h1 class="w3-wide w3-center">Market Page</h1>
  </div>
</header>


<hr>
<div class="w3-container">
  

  <div class="row">
    <div class="col-12">
      <div id="showMarketDetails">
        <ng-container *ngIf="Showsell">
          <div *ngFor="let order of sellorders">
            <div class='w3-card-4 w3-margin w3-padding'>
              <div class="row">
                <div class="col-4">
                  <p>
                    Seller: {{order.Seller}}
                  </p>
                </div>
                <div class="col-4">
                  <p>
                    Amount: {{order.Amount}}
                  </p>
                </div>
                <div class="col-4">
                  <p>
                    Price: {{order.Price}}
                  </p>
                </div>
                <button class='w3-button w3-black w3-padding-small w3-margin-right' (click)="PressBuy(order)">Buy</button>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="Showbuy">
          <div *ngFor="let order of buyorders">
            <div class='w3-card-4 w3-margin w3-padding'>
              <div class="row">
                <div class="col-4">
                  <p>
                    Buyer: {{order.Buyer}}
                  </p>
                </div>
                <div class="col-4">
                  <p>
                    Amount: {{order.Amount}}
                  </p>
                </div>
                <div class="col-4">
                  <p>
                    Price: {{order.Price}}
                  </p>
                </div>
                <button class='w3-button w3-black w3-padding-small w3-margin-right' (click)="PressSell(order)">Sell</button>
              </div>
            </div>
          </div>
        </ng-container>
          
      </div>
    </div>
  </div> -->
  
    <!--  Buy Energy Modal -->
  <!-- <div id="buyModal" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
      <header class="w3-container w3-dark-gray w3-center w3-padding-32"> 
        <span onclick="document.getElementById('buyModal').style.display='none'" 
       class="w3-button w3-dark-gray w3-xlarge w3-display-topright">&times;</span>
        <h2 class="w3-wide"><i class="fa fa-suitcase w3-margin-right"></i>BUY</h2>
      </header>
      <div class="w3-container">
        
        
        <h1>
          <label><i class="fa fa-user"></i>Seller</label>
          :{{CurrentOrder.Seller}}
        </h1>
        <p>
          Available Amount To Buy: {{CurrentOrder.Amount}}KWh
        </p>
        <p>Price: {{CurrentOrder.Price}} $/KWh</p>
        <p>Balance in wallet <i class="fa fa-money"></i>: {{ user.CurrencyBalance}}$</p>

        <p><label><i class="fa fa-bolt"></i>Amount</label>
          <input class="w3-input w3-border" type="number" min="0" 
          value="0" step="0.01" 
          placeholder="Amount of energy (KWh)" [(ngModel)]="block.Amount">
        </p>
        <p>
          To Pay: {{block.Amount*CurrentOrder.Price}}$
        </p>

       
        <button (click)="AddBuyTransaction()" 
        class="w3-button w3-block w3-teal w3-padding-16 w3-section w3-right">
        BUY <i class="fa fa-check"></i></button>
      </div>
    </div>
  </div> -->


  <!--  Sell Energy Modal -->
  <!-- <div id="sellModal" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
      <header class="w3-container w3-dark-gray w3-center w3-padding-32"> 
        <span onclick="document.getElementById('sellModal').style.display='none'" 
       class="w3-button w3-dark-gray w3-xlarge w3-display-topright">&times;</span>
        <h2 class="w3-wide"><i class="fa fa-suitcase w3-margin-right"></i>SELL</h2>
      </header>
      <div class="w3-container">
        <h1>
          <label><i class="fa fa-user"></i>Buyer</label>
          :{{CurrentOrder.Buyer}}
        </h1>
        <p>
          Amount Needed By Buyer: {{CurrentOrder.Amount}}KWh
        </p>
        <p>Price: {{CurrentOrder.Price}} $/KWh</p>
        <p>Balance in wallet <i class="fa fa-bolt"></i>: {{ user.EnergyBalance}} KWh</p>

        <p><label><i class="fa fa-bolt"></i>Amount</label>
          <input class="w3-input w3-border" type="number" min="0" 
          value="0" step="0.01" 
          placeholder="Amount of energy (KWh)" [(ngModel)]="block.Amount">
        </p>
        <p>
          To Receive: {{block.Amount*CurrentOrder.Price}}$
        </p>
        <button (click)="AddSellTransaction()" class="w3-button w3-block w3-teal w3-padding-16 w3-section w3-right"> 
          SELL <i class="fa fa-check"></i></button>
        
      </div>
    </div>
  </div>
  
</div> -->

